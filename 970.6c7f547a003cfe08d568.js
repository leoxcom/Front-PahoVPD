"use strict";(self.webpackChunkimpodatos_front=self.webpackChunkimpodatos_front||[]).push([[970],{970:(rt,C,r)=>{r.r(C),r.d(C,{DashboardModule:()=>nt});var m=r(8583),d=r(4655),t=r(7716),u=r(8958),y=r(2522),T=r(1095),_=r(6627);let U=(()=>{class o{constructor(e){this._loginService=e}ngOnInit(){}logout(){this._loginService.logout()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(u.r))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-navbar"]],decls:12,vars:0,consts:[["color","primary"],[1,"menu-spacer"],["mat-button","","routerLink","/dashboard"],["mat-button","","routerLink","/dashboard/history"],["mat-icon-button","","aria-label","Example icon-button with share icon",1,"example-icon",3,"click"]],template:function(e,a){1&e&&(t.TgZ(0,"mat-toolbar",0),t.TgZ(1,"span"),t._uU(2,"App Impodatos"),t.qZA(),t._UZ(3,"span",1),t.TgZ(4,"button",2),t._uU(5,"Subir Archivo"),t.qZA(),t.TgZ(6,"button",3),t._uU(7,"Historial"),t.qZA(),t._UZ(8,"span",1),t.TgZ(9,"button",4),t.NdJ("click",function(){return a.logout()}),t.TgZ(10,"mat-icon"),t._uU(11,"logout"),t.qZA(),t.qZA(),t.qZA())},directives:[y.Ye,T.lW,d.rH,_.Hw],styles:[".menu-spacer[_ngcontent-%COMP%]{flex:1 1 auto}"]}),o})(),D=(()=>{class o{constructor(){}ngOnInit(){}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-dashboard"]],decls:2,vars:0,template:function(e,a){1&e&&(t._UZ(0,"app-navbar"),t._UZ(1,"router-outlet"))},directives:[U,d.lC],styles:[""]}),o})();var v=r(9692),f=r(1494),l=r(2789),h=r(4073),H=r(1841);let A=(()=>{class o{constructor(e,a){this._http=e,this._loginService=a}getSelectProgram(){let e=this._loginService.getToken();return this._http.get(h.e.ENDPOINTBACK+"DhisIntegration/getAllProgram/"+e)}uploadFile(e){return this._http.post(h.e.ENDPOINTBACK+"history",e)}getHistoryUser(e){return this._http.get(h.e.ENDPOINTBACK+"history/user?user="+e)}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(H.eN),t.LFG(u.r))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var g=r(8295),N=r(9983),b=r(1436);function S(o,n){1&o&&(t.TgZ(0,"th",19),t._uU(1," Id Registro "),t.qZA())}function F(o,n){if(1&o&&(t.TgZ(0,"td",20),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",e.id," ")}}function Y(o,n){1&o&&(t.TgZ(0,"th",21),t._uU(1," Programa Id "),t.qZA())}function M(o,n){if(1&o&&(t.TgZ(0,"td",20),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",e.programsid," ")}}function O(o,n){1&o&&(t.TgZ(0,"th",21),t._uU(1," Usuario "),t.qZA())}function q(o,n){if(1&o&&(t.TgZ(0,"td",20),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",e.userLogin," ")}}function P(o,n){1&o&&(t.TgZ(0,"th",19),t._uU(1," Fecha "),t.qZA())}function I(o,n){if(1&o&&(t.TgZ(0,"td",20),t._uU(1),t.ALo(2,"date"),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.fecha,"dd-MM-yyyy HH:mm:ss")," ")}}function w(o,n){1&o&&(t.TgZ(0,"th",21),t._uU(1," Estado "),t.qZA())}function J(o,n){if(1&o&&(t.TgZ(0,"td",20),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",e.state," ")}}function B(o,n){1&o&&(t.TgZ(0,"th",21),t._uU(1," Descargar "),t.qZA())}function Q(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"td",22),t.TgZ(1,"a",23),t.TgZ(2,"mat-icon",24,25),t.NdJ("click",function(){const s=t.CHM(e).index;return t.oxw().descargar(s)}),t._uU(4,"download"),t.qZA(),t.qZA(),t.qZA()}}function E(o,n){1&o&&t._UZ(0,"tr",26)}function R(o,n){1&o&&t._UZ(0,"tr",27)}const j=function(){return[5,10,25,100]};let k=(()=>{class o{constructor(e,a){this._uploaderService=e,this._login=a,this.displayedColumns=["idRegistro","programId","usuario","estado","fecha","acciones"],this.dataSource=new l.by(this.historyData)}ngOnInit(){const e=this._login.getToken();this.getHistory(e)}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}getHistory(e){this._uploaderService.getHistoryUser(e).subscribe(a=>{this.historyData=a,this.dataSource=new l.by(a),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort})}applyFilter(e){this.dataSource.filter=e.target.value.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}descargar(e){console.log("sedescargo "+this.historyData[e].file),this.downloadFile(this.historyData[e].file,this.historyData[e].programsid)}downloadFile(e,a){const i=`data:application/octet-stream;base64,${e}`,s=document.createElement("a");s.href=i,s.download=`${a}.csv`,s.click()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(A),t.Y36(u.r))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-history"]],viewQuery:function(e,a){if(1&e&&(t.Gf(v.NW,5),t.Gf(f.YE,5)),2&e){let i;t.iGM(i=t.CRH())&&(a.paginator=i.first),t.iGM(i=t.CRH())&&(a.sort=i.first)}},decls:32,vars:5,consts:[[1,"container"],["appearance","standard"],["matInput","","placeholder","Ex. ium","autocomplete","off",3,"keyup"],["input",""],[1,"mat-elevation-z8"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","idRegistro"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","programId"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","usuario"],["matColumnDef","fecha"],["matColumnDef","estado"],["matColumnDef","acciones"],["mat-cell","","style"," text-align:center",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["aria-label","Select page of users",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-cell","",2,"text-align","center"],[1,"pointer"],["matTooltip","Descargar Archivo",3,"click"],["tooltip","matTooltip"],["mat-header-row",""],["mat-row",""]],template:function(e,a){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"mat-toolbar"),t.TgZ(2,"span"),t._uU(3,"Historial"),t.qZA(),t.qZA(),t.TgZ(4,"mat-form-field",1),t.TgZ(5,"mat-label"),t._uU(6,"Filter"),t.qZA(),t.TgZ(7,"input",2,3),t.NdJ("keyup",function(s){return a.applyFilter(s)}),t.qZA(),t.qZA(),t.TgZ(9,"div",4),t.TgZ(10,"table",5),t.ynx(11,6),t.YNc(12,S,2,0,"th",7),t.YNc(13,F,2,1,"td",8),t.BQk(),t.ynx(14,9),t.YNc(15,Y,2,0,"th",10),t.YNc(16,M,2,1,"td",8),t.BQk(),t.ynx(17,11),t.YNc(18,O,2,0,"th",10),t.YNc(19,q,2,1,"td",8),t.BQk(),t.ynx(20,12),t.YNc(21,P,2,0,"th",7),t.YNc(22,I,3,4,"td",8),t.BQk(),t.ynx(23,13),t.YNc(24,w,2,0,"th",10),t.YNc(25,J,2,1,"td",8),t.BQk(),t.ynx(26,14),t.YNc(27,B,2,0,"th",10),t.YNc(28,Q,5,0,"td",15),t.BQk(),t.YNc(29,E,1,0,"tr",16),t.YNc(30,R,1,0,"tr",17),t.qZA(),t._UZ(31,"mat-paginator",18),t.qZA(),t.qZA()),2&e&&(t.xp6(10),t.Q6J("dataSource",a.dataSource),t.xp6(19),t.Q6J("matHeaderRowDef",a.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",a.displayedColumns),t.xp6(1),t.Q6J("pageSizeOptions",t.DdM(4,j)))},directives:[y.Ye,g.KE,g.hX,N.Nt,l.BZ,f.YE,l.w1,l.fO,l.Dz,l.as,l.nj,v.NW,l.ge,f.nU,l.ev,_.Hw,b.gM,l.XQ,l.Gk],pipes:[m.uU],styles:["table[_ngcontent-%COMP%]{width:100%}th[_ngcontent-%COMP%]{width:20%}.container[_ngcontent-%COMP%]{margin:3%}.mat-form-field[_ngcontent-%COMP%]{font-size:14px;width:100%}.pointer[_ngcontent-%COMP%]{cursor:pointer}"]}),o})();var c=r(3679),G=r(8259),Z=r.n(G),z=r(4885),L=r(3738),$=r(7441),X=r(2458);function K(o,n){1&o&&t._UZ(0,"mat-spinner",4)}function W(o,n){if(1&o&&(t.TgZ(0,"mat-option",14),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.Q6J("value",e.programid),t.xp6(1),t.hij(" ",e.programname," ")}}function V(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"form",5),t.TgZ(1,"mat-card",6),t.TgZ(2,"table"),t.TgZ(3,"tr"),t.TgZ(4,"td"),t.TgZ(5,"mat-form-field",7),t.TgZ(6,"mat-label"),t._uU(7,"Seleccione un programa"),t.qZA(),t.TgZ(8,"mat-select",8),t.YNc(9,W,2,2,"mat-option",9),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(10,"tr"),t.TgZ(11,"td"),t.TgZ(12,"input",10,11),t.NdJ("change",function(i){return t.CHM(e),t.oxw().onFileSelected(i)}),t.qZA(),t.qZA(),t.qZA(),t.TgZ(14,"tr"),t.TgZ(15,"td"),t.TgZ(16,"input",12,11),t.NdJ("change",function(i){return t.CHM(e),t.oxw().onFileSelected(i)}),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t._UZ(18,"br"),t.TgZ(19,"button",13),t.NdJ("click",function(){return t.CHM(e),t.oxw().onUpload()}),t._uU(20,"Procesar"),t.qZA(),t.qZA(),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("formGroup",e.form),t.xp6(9),t.Q6J("ngForOf",e.selectProgramsOptions),t.xp6(10),t.Q6J("disabled",e.form.invalid)}}let x=(()=>{class o{constructor(e,a,i){this._uploaderService=e,this.fb=a,this._login=i,this.loading=!1,this.form=this.fb.group({program:["",c.kI.required],attachment:["",c.kI.required]})}ngOnInit(){this.loadSelectPrograms()}loadSelectPrograms(){this._uploaderService.getSelectProgram().subscribe(e=>{let{programs:a}=e;this.selectProgramsOptions=a})}onUpload(){this.loading=!0;const e=this.uploadFile[0],a=this.uploadFile01[0];let i=new FormData;i.append("Programsid",this.form.value.program),i.append("UserLogin",this._login.getUsuario()),i.append("CsvFile",e,e.name),i.append("CsvFile01",a,a.name),i.append("Yearinit",""),i.append("token",this._login.getToken()),this._uploaderService.uploadFile(i).subscribe(s=>{let p="";if(!s)return p="El archivo se proceso Exitosamente",this.loading=!1,Z().fire(p);for(let at in s)p=p+s[at].errorMessage+"\n ";return this.loading=!1,Z().fire("No se pudo procesar el archivo  por los siguientes motivos: \n"+p)},s=>(this.loading=!1,Z().fire("Ocurrio un error Intente de nuevo")))}onFileSelected(e){"file"==e.target.id&&(this.uploadFile=e.target.files),"file01"==e.target.id&&(this.uploadFile01=e.target.files)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(A),t.Y36(c.qu),t.Y36(u.r))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-uploader"]],decls:4,vars:2,consts:[[1,"body"],[1,"card"],["class","spinner","diameter","50",4,"ngIf"],[3,"formGroup",4,"ngIf"],["diameter","50",1,"spinner"],[3,"formGroup"],[1,"option-card"],["appearance","fill"],["formControlName","program"],[3,"value",4,"ngFor","ngForOf"],["requiredFiel","","formControlName","attachment","type","file","id","file",1,"btn",3,"change"],["fileInput",""],["formControlName","attachment","type","file","id","file01",1,"btn",3,"change"],["mat-raised-button","","color","primary","type","submit",1,"loginElement","button",3,"disabled","click"],[3,"value"]],template:function(e,a){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.YNc(2,K,1,0,"mat-spinner",2),t.YNc(3,V,21,3,"form",3),t.qZA(),t.qZA()),2&e&&(t.xp6(2),t.Q6J("ngIf",a.loading),t.xp6(1),t.Q6J("ngIf",!a.loading))},directives:[m.O5,z.$g,c._Y,c.JL,c.sg,L.a8,g.KE,g.hX,$.gD,c.JJ,c.u,m.sg,c.Fj,T.lW,X.ey],styles:[".option-card[_ngcontent-%COMP%]{max-width:100%}.body[_ngcontent-%COMP%]{display:flex;justify-content:left;height:100%;align-items:top;background-color:#f5f5f5;padding:2% 4%}.card[_ngcontent-%COMP%]{width:100%;text-align:left}.input_examinar[_ngcontent-%COMP%]{width:300%}.spinner[_ngcontent-%COMP%]{margin:0 auto}"]}),o})();const tt=[{path:"",component:D,children:[{path:"",component:x},{path:"upload",component:x},{path:"history",component:k}]}];let ot=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[d.Bz.forChild(tt)],d.Bz]}),o})();var et=r(4466);let nt=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[m.ez,ot,et.m]]}),o})()}}]);